# Статьи

В данном документе описаны все технические моменты, которые необходимо знать для работы со статьями через API.

## Строение статьи

На данный момент статья хранится в базе данных в подобном формате:

```json 
	"_id": "уникальный ID статьи, сгенерированный MongoDB",
	"content_type": "тип статьи, может быть обычной статьей, либо новостью (технически без ограничений)",
	"header": "Название статьи",
	"author_id": "Автор статьи (временно равно system по умолчанию)",
	"contents": [
	    {
	        "type": "тип_контента, подробнее описано ниже",
	        "value": "содержимое типа"
	    }
	],
	"tags": [
	    "тег статьи, может быть несколько"
	],
	"create_time": "дата создания статьи, хранится в текстовом представлении Date()",
	"last_update_time": "дата последнего обновления, хранится в текстовом представлении Date()",
	"is_archived": "является ли статья заархивированной; true/false"
```

## Доступные форматы контента

Как описано выше, в массиве `contents` может находиться несколько обьектов.
Внутри каждого объекта ОБЯЗАТЕЛЬНО должен быть ключ `type` - благодаря нему сайт понимает, как отображать контент
Второй обязательный ключ `value` - описывает этот контент (его содержимое)
На данный момент доступны следующие форматы: 

|Формат     |Тип            |Аргументы          |Описание                             |
|-----------|---------------|-------------------|-------------------------------------|
|`markdown` |Строка `String`|`value` - текст    |Текст с разметкой Markdown           |
|`image_url`|Строка `String`|`value` - ссылка   |Картинка                             |

Ячеек с контентом может быть неограниченное количество, все они обрабатываются последовательно.

## Теги 

У каждой статьи может быть неограниченное количество тегов. Теги предназначены для более удобной сортировки статей по их контенту.

# Работа с маршрутом "Статьи"

Здесь описаны методы работы со статьями через API. Все аргументы, передаваемые вами, **должны** находиться в `Body` запроса. Возвращаемые с API значения передаются как `application/json` и имеют свой код HTTP-состояния.

Если пользователь не указывает в запросе одну из обязательных переменных, ему возвращается статус-код `400 Bad Request` и `JSON` массив:

```json
{"msg": "<ошибка об отсутствующей переменной>"}
``` 

## Получение списка статей

Список статей может быть получен с помощью GET-запроса на сайт: 

```
GET (полный путь сайта, включая протокол и порт)/<версия_апи>/articles/
```

_прим.: на данный момент `<версия_апи>` равна `v1`_

### Принимаемые аргументы

Единственные принимаемые аргументы - **фильтры**. Вы можете получить статьи по определенным критериям, для этого необходимо указать в **Body** массив `filters` формата **JSON**. На данный момент принимаются следующие фильтры (все они должны находиться внутри массива `filters`: 

|Название фильтра|Тип аргумента  |Описание                               |
|----------------|---------------|---------------------------------------|
|`content_type`  |Строка `String`|Отбирает статьи определенного характера|
|`author_id`     |Строка `String`|Отбирает статьи определенного автора   |
|`tags`          |Массив `Array` |Отбирает статьи по определенным тегам  |

### Возвращаемое значение

При успешной обработке запроса возвращается статус-код `200 OK` и **JSON**-массив всех статей, найденных согласно фильтру (если они есть). Если не будет найдено ни одной статьи, запрос вернет `[]` (пустой массив). Все возвращенные статьи будут в традиционном формате, который описан ранее в этом документе.

Если при обработке запроса произойдет ошибка, API вернет статус-код `500 Internal Server Error` и **JSON** массив вида:
```json
{"msg": "Ошибка при получении списка статей: (ошибка)"}
```

## Добавление статьи

Добавление статьи происходит с помощью POST-запроса на сайт: 
```
POST (полный путь сайта, включая протокол и порт)/<версия_апи>/articles/add
```

_прим.: на данный момент_ `<версия_апи>` _равна_ `v1`

### Принимаемые аргументы

|Аргумент      |Тип аргумента  |Обязательный|Описание                                  |
|--------------|---------------|------------|------------------------------------------|
|`name`        |Строка `String`|**Да**      |Название статьи, видное всем пользователям|
|`content_type`|Строка `String`|**Нет**     |Тип статьи. По умолчанию `article`        |
|`author`      |Строка `String`|**Нет**     |Автор статьи                              |
|`contents`    |Массив `Array` |**Нет**     |Контент статьи. Описывается согласно модели статей, о которой написано сверху|
|`tags`        |Массив `Array` |**Нет**     |Теги статьи. Описываются согласно модели статей, о которой написано сверху|

### Возвращаемое значение

При успешном добавлении возвращается статус-код `200 OK` и `JSON` массив:

```json
{"msg": "Статья добавлена!"}
```

При любой внутренней ошибке, связанной с обработкой запроса, возвращается статус-код `500 Internal Server Error` и `JSON` массив:

```json
{"msg": "<текст ошибки>"}
```

## Архивация статьи 

Статью можно архивировать. Архивированная статья не будет показываться при получении списка статей через API (даже если попросить)

Архивация происходит с помощью POST-запроса на сайт: 

```
POST (полный путь сайта, включая протокол и порт)/<версия_апи>/articles/archive
```

### Принимаемые аргументы

|Аргумент      |Тип аргумента  |Обязательный|Описание                                  |
|--------------|---------------|------------|------------------------------------------|
|`article_id`  |Строка `String`|**Да**      |Внутренний ID статьи                      |

### Возвращаемое значение 

При успешном архивировании возвращается статус-код `200 OK` и `JSON` массив:

```json
{"msg": "Статья успешно архивирована!"}
```

При попытке выполнить запрос на архивированной статье возвращается статус-код `400 Bad Request` и `JSON` массив:

```json
{"msg": "Статья уже архивирована!"}
```

При возникновении внутренних ошибок возвращается статус-код `500 Internal Server Error` и `JSON` массив:

```json
{"msg": "<текст ошибки, может быть объектом>"}
```

## Удаление статьи из архива 

Ровно как статью можно архивировать, ее можно и достать из архива. Для этого необходимо выполнить POST-запрос:

```
POST (полный путь сайта, включая протокол и порт)/<версия_апи>/articles/unarchive
```

### Принимаемые аргументы

|Аргумент      |Тип аргумента  |Обязательный|Описание                                  |
|--------------|---------------|------------|------------------------------------------|
|`article_id`  |Строка `String`|**Да**      |Внутренний ID статьи                      |

### Возвращаемое значение 

При успешном удалении из архива возвращается статус-код `200 OK` и `JSON` массив:

```json
{"msg": "Статья успешно удалена из архива!"}
```

При попытке выполнить запрос на неархивированной статье возвращается статус-код `400 Bad Request` и `JSON` массив:

```json
{"msg": "Данной статьи нет в архиве!"}
```

При возникновении внутренних ошибок возвращается статус-код `500 Internal Server Error` и `JSON` массив:

```json
{"msg": "<текст ошибки>"}
```
